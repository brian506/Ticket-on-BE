<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê²°ì œ ì„±ê³µ</title>
</head>
<body>
<h1>âœ… ê²°ì œê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h1>
<p id="status">ê²°ì œ ìŠ¹ì¸ ì²˜ë¦¬ ì¤‘...</p>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const paymentKey = urlParams.get('paymentKey');
    const orderId = urlParams.get('orderId'); // = ticketId
    const amount = urlParams.get('amount');
    const memberId = urlParams.get('memberId');

    const ticketId = Number(orderId);

    fetch('http://localhost:8080/v1/payments/confirm', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            memberId: Number(memberId),
            paymentKey: paymentKey,
            ticketId: orderId, // âœ… orderId = ticketId
            amount: Number(amount)
        })
    })
        .then(res => {
            if (!res.ok) throw new Error('ê²°ì œ ìŠ¹ì¸ ì‹¤íŒ¨');
            return res.json();
        })
        .then(data => {
            document.getElementById('status').innerText = 'ğŸ‰ ê²°ì œ ìŠ¹ì¸ ì™„ë£Œ!';
        })
        .catch(err => {
            document.getElementById('status').innerText = 'âŒ ì˜¤ë¥˜: ' + err.message;
        });
</script>
</body>
</html>
