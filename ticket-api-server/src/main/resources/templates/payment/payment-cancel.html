<!-- templates/cancel.html -->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê²°ì œ ì·¨ì†Œ</title>
</head>
<body>
<h1>ðŸ§¾ ê²°ì œ ì·¨ì†Œ ìš”ì²­</h1>

<label for="paymentKey">ðŸ“Œ Payment Key:</label>
<input type="text" id="paymentKey"
       th:value="${paymentKey}"
       readonly><br><br>

<label for="cancelAmount">ðŸ’¸ ì·¨ì†Œ ê¸ˆì•¡:</label>
<input type="number" id="cancelAmount"
       th:value="${cancelAmount}"
       readonly><br><br>

<label for="cancelReason">ðŸ’¬ ì·¨ì†Œ ì‚¬ìœ :</label>
<input type="text" id="cancelReason"
       placeholder="ë‹¨ìˆœë³€ì‹¬"><br><br>

<button onclick="cancelPayment()">ì·¨ì†Œ ìš”ì²­</button>
<p id="status"></p>

<script th:inline="javascript">
    /*<![CDATA[*/
    function cancelPayment() {
        const paymentKey   = document.getElementById('paymentKey').value;
        const cancelAmount = parseInt(document.getElementById('cancelAmount').value);
        const cancelReason = document.getElementById('cancelReason').value;

        if (!paymentKey || isNaN(cancelAmount)) {
            document.getElementById('status').innerText = 'âš ï¸ ëª¨ë“  ê°’ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”.';
            return;
        }

        fetch('[[@{/v1/payments/cancel}]]', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                paymentKey, cancelAmount, cancelReason
            })
        })
            .then(res => { if (!res.ok) throw new Error('ê²°ì œ ì·¨ì†Œ ì‹¤íŒ¨'); return res.json(); })
            .then(_ => { document.getElementById('status').innerText = 'âœ… ê²°ì œ ì·¨ì†Œ ì„±ê³µ!'; })
            .catch(err => { document.getElementById('status').innerText = 'âŒ ì˜¤ë¥˜: ' + err.message; });
    }
    /*]]>*/
</script>
</body>
</html>
